{% extends "skeleton.html" %}

{% block contents %}

{% if usr %}



<a class="btn btn-primary rounded-circle p-1  position-fixed bottom-50 end-1 m-3 z-3" id="uploadPhoto" role="button"
  data-bs-toggle="modal" data-bs-target="#uploadPhotoModal">
  <img width="24px" src="/static/icons/upload.svg" title="Upload" />
</a>

<br><br><br><br>
<!-- Modal -->
<div class="modal fade" id="uploadPhotoModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"
  data-bs-backdrop="static">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Subir fotografía</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="uploadPhoto" name="uploadPhoto" action="/photo/add" enctype="multipart/form-data" method="POST">

          <!-- Image file -->
          <div class="form-group">
            <figure class="image-container">
              <img id="chosen-image" class="rounded"
                style="display: block;position: relative;margin: auto;max-width: 100%; max-height: 300px;">
            </figure>

            <input type="file" id="uploadedPhoto" name="uploadedPhoto" accept="image/*" style="display: none;" onchange="let reader = new FileReader();
            reader.readAsDataURL(document.getElementById('uploadedPhoto').files[0]);
            reader.onload = () => {
              document.getElementById('chosen-image').setAttribute('src', reader.result);
            }">
            <label for="uploadedPhoto" style="display: block;
                    position: relative;
                    background-color: #025bee;
                    color: #ffffff;
                    font-size: 18px;
                    text-align: center;
                    width: 300px;
                    padding: 18px 0;
                    border-radius: 5px;
                    margin: auto;
                    cursor: pointer;">
              <img src="/static/icons/upload.svg"> &nbsp; Subir fotografía
            </label>
          </div>

          <!-- Caption input -->
          <div class="form-group">
            <label for="caption">Pie de foto</label>
            <input type="text" id="caption" name="caption" class="form-control" placeholder="Pie de foto..." />
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          <img width="24px" src="/static/icons/arrow-left.svg" title="CloseModal" />
        </button>
        <!-- Submit button -->
        <button type="submit" class="btn btn-primary" onclick="document.uploadPhoto.submit()">
          <img width="24px" src="/static/icons/upload.svg" title="Upload" />
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Contenido principal -->
<div class="container">
  <h1 class="text-center">Imágenes</h1>
  <!-- Cuadrícula centrada para mostrar imágenes -->
  <div class="row justify-content-center">
    <!-- Aquí irán las imágenes de tu base de datos -->
    {% for image in image_list %}
    <div class="col-md-4">
      <div class="card mb-3">
        <img src="{{ image.url }}" class="card-img-top" alt="Imagen">
        <div class="card-body">
          <a href="/account/{{ image.usrname }}" class="text-decoration-none link-dark"> <b>{{ image.usrname }}</b></a>
          <p class="card-title">{{ image.caption }}</p>
          <div class="d-flex justify-content-start">
            <div class="like-container d-flex flex-column align-items-center">
              <form action="/photo/like" method="post">
                <input type="text" id="hiddenUrl" name="hiddenUrl" value="{{ image.url }}" hidden>
                <button type="submit" class="btn">
                  <img
                    src="{% if current_user.username in image.liked_by %}/static/icons/like-red.svg{% else %}/static/icons/like-white.svg{% endif %}"
                    alt="Like">
                </button>
                <p style="text-align: center;">{{ image.likes }}</p>
              </form>
            </div>
          </div>

          {% if current_user.username == image.usrname %}
          <!-- Abre el modal -->
          <a class="btn btn-primary" id="modifyButton" role="button" data-bs-toggle="modal"
            data-bs-target="#editPhotoModal">
            <img width="24px" src="/static/icons/edit.svg" title="Edit" />
          </a>


          <a class="btn btn-danger" id="deleteButton" role="button" data-bs-toggle="modal"
            data-bs-target="#deletePhotoModal">
            <img width="24px" src="/static/icons/trash.svg" title="Delete" />
          </a>

          <!-- Modal -->
          <div class="modal fade" id="deletePhotoModal" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Eliminar fotografía</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  ¿Está seguro de eliminar la fotografía?
                </div>
                <div class="modal-footer">
                  <button class="btn btn-secondary" data-bs-dismiss="modal">
                    <img width="24px" src="/static/icons/arrow-left.svg" title="CloseModal" />
                  </button>
                  <!-- Submit button -->
                  <button type="submit" class="btn btn-danger"
                    onclick="window.location = '/photo/delete?photo_id={{ image.get_safe_id(srp) }}'">
                    <img width="24px" src="/static/icons/trash.svg" title="Modify" />
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal -->
          <div class="modal fade" id="editPhotoModal" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Edit Photo</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form id="frmModify" name="frmModify" action="/photo/modify" enctype="multipart/form-data"
                    method="POST">
                    <input type="text" id="hiddeUrl" name="hiddenUrl" class="form-control" hidden
                      value="{{ image.url }}" />
                    <!-- Caption input -->
                    <div class="form-group">
                      <label for="modifyCaption">Pie de Foto</label>
                      <input type="text" id="modifyCaption" name="modifyCaption" class="form-control" />
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-secondary" data-bs-dismiss="modal">
                    <img width="24px" src="/static/icons/arrow-left.svg" title="CloseModal" />
                  </button>
                  <!-- Submit button -->
                  <button type="submit" class="btn btn-primary" onclick="document.frmModify.submit()">
                    <img width="24px" src="/static/icons/edit.svg" title="Modify" />
                  </button>
                </div>
              </div>
            </div>
          </div>




          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{% else %}
<div style="width: 26%; margin-left: 37%; padding-top: 10%;">

  <!-- Pills navs -->
  <ul class="nav nav-pills nav-justified mb-3" id="ex1" role="tablist">
    <li class="nav-item" role="presentation">
      <a class="nav-link active" id="tab-login" data-mdb-pill-init href="#pills-login" role="tab"
        aria-controls="pills-login" aria-selected="true">Login</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link" id="tab-register" data-mdb-pill-init href="#pills-register" role="tab"
        aria-controls="pills-register" aria-selected="false">Register</a>
    </li>
  </ul>
  <!-- Pills navs -->

  <!-- Pills content -->
  <div class="tab-content">
    <div class="tab-pane fade show active" id="pills-login" role="tabpanel" aria-labelledby="tab-login">
      <form id="frmLogin" name="frmLogin" action="/login" method="POST">
        <!-- Email input -->
        <div data-mdb-input-init class="form-outline mb-4">
          <input type="text" id="loginName" name="loginName" class="form-control" />
          <label class="form-label" for="loginName">Email or username</label>
        </div>

        <!-- Password input -->
        <div data-mdb-input-init class="form-outline mb-4">
          <input type="password" id="loginPassword" name="loginPassword" class="form-control" />
          <label class="form-label" for="loginPassword">Password</label>
        </div>

        <!-- Submit button -->

        <a class="btn btn-primary" href="#" onclick="document.frmLogin.submit()" role="button">
          <img width="24px" src="/static/icons/log-in.svg" title="Login" />
        </a>
        <input type="submit" hidden />
      </form>
    </div>
    <div class="tab-pane fade" id="pills-register" role="tabpanel" aria-labelledby="tab-register">
      <form id="frmRegister" name="frmRegister" action="/user/add" method="POST">
        <!-- Name input -->
        <div data-mdb-input-init class="form-outline mb-4">
          <input type="text" id="registerName" name="registerName" class="form-control" />
          <label class="form-label" for="registerName">Name</label>
        </div>

        <!-- Username input -->
        <div data-mdb-input-init class="form-outline mb-4">
          <input type="text" id="registerUsername" name="registerUsername" class="form-control" />
          <label class="form-label" for="registerUsername">Username</label>
        </div>

        <!-- Email input -->
        <div data-mdb-input-init class="form-outline mb-4">
          <input type="email" id="registerEmail" name="registerEmail" class="form-control" />
          <label class="form-label" for="registerEmail">Email</label>
        </div>

        <!-- Password input -->
        <div data-mdb-input-init class="form-outline mb-4">
          <input type="password" id="registerPassword" name="registerPassword" class="form-control" />
          <label class="form-label" for="registerPassword">Password</label>
        </div>

        <!-- Repeat Password input -->
        <div data-mdb-input-init class="form-outline mb-4">
          <input type="password" id="registerRepeatPassword" name="registerRepeatPassword" class="form-control" />
          <label class="form-label" for="registerRepeatPassword">Repeat password</label>
        </div>


        <!-- Submit button -->
        <a class="btn btn-primary" href="#" onclick="document.frmRegister.submit()" role="button">
          <img width="24px" src="/static/icons/user-plus.svg" title="Login" />
        </a>
        <input type="submit" hidden />
      </form>
    </div>
  </div>
  <!-- Pills content -->

</div>




<script>
  $(document).ready(function () {
    $('#tab-register').click(function () {
      event.preventDefault();
      $('#tab-login').removeClass('active show');
      $('#pills-login').removeClass('active show');
      $('#tab-register').addClass('active show');
      $('#pills-register').addClass('active show');
    });

    $('#tab-login').click(function () {
      event.preventDefault();
      $('#tab-register').removeClass('active show');
      $('#pills-register').removeClass('active show');
      $('#tab-login').addClass('active show');
      $('#pills-login').addClass('active show');
    });
  });


</script>

{% endif %}
{% endblock %}